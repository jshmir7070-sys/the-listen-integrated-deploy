<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>í˜„ì¬ ì§€ë„ - The Listen</title>
<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=301ef23f56e23f0dee3eaf47fe734b03&libraries=services"></script>
<style>
  :root{
    --brand:#007bff;--muted:#6b7280;--ok:#10b981;--danger:#ef4444;
    --card:#fff;--bg:#f7f9fc;--border:#e5e7eb;
  }
  body{margin:0;font-family:"Noto Sans KR",sans-serif;background:var(--bg)}
  header{background:var(--brand);color:#fff;text-align:center;padding:10px;font-weight:800}
  #map{width:100%;height:90vh;position:relative}
  .btn{border:none;padding:10px 14px;border-radius:10px;margin:6px;color:#fff;background:var(--brand);font-weight:700;cursor:pointer}
  .btn.gray{background:#6b7280}
  .btn.green{background:var(--ok)}
  .btn.red{background:var(--danger)}
  .muted{color:var(--muted)}
  .flex{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
  /* í•˜ë‹¨ ë™ ê·¸ë£¹ ì¹´ë“œ */
  #card{position:fixed;left:0;bottom:0;width:100%;background:var(--card);border-radius:16px 16px 0 0;
        box-shadow:0 -4px 14px rgba(0,0,0,.2);transform:translateY(100%);transition:transform .35s;z-index:3}
  #card.active{transform:translateY(0)}
  .card-inner{padding:14px 14px 8px}
  .title{font-weight:900;margin-bottom:6px;text-align:center}
  .list{max-height:40vh;overflow:auto;border:1px solid #eef2f7;border-radius:12px;padding:8px;background:#fff}
  .item{border:1px solid var(--border);border-radius:12px;padding:10px;margin-bottom:8px;cursor:pointer}
  .item .line1{display:flex;justify-content:space-between;gap:8px;align-items:center}
  .badge{display:inline-flex;align-items:center;justify-content:center;min-width:28px;height:28px;border-radius:999px;color:#fff;font-weight:900;border:2px solid #fff;font-size:13px}
  .tel{color:var(--brand);text-decoration:none}
  /* ìƒì„¸ ì „ì²´ ì°½ */
  #detail{position:fixed;left:0;top:0;width:100%;height:100%;background:var(--card);
          box-shadow:0 -4px 16px rgba(0,0,0,.25);transform:translateY(100%);transition:transform .35s;z-index:4;overflow-y:auto}
  #detail.active{transform:translateY(0)}
  .detail-inner{padding:16px}
  .section-title{font-weight:900;margin:10px 0 4px}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  .col{flex:1;min-width:220px}
  input[type="text"],select,textarea{width:100%;padding:10px;border:1px solid var(--border);border-radius:10px;font-size:14px}
  textarea:disabled,input:disabled{background:#f3f4f6;color:#6b7280}
  /* ì‚¬ì§„ ë¹„êµ ì¢Œìš°ëŒ€ì¹­ */
  .thumbs{display:flex;justify-content:space-around;align-items:flex-start;gap:10px;margin:10px 0}
  .thumb-box{width:48%;text-align:center}
  .thumb-box img{width:100%;max-width:260px;height:170px;object-fit:cover;border-radius:10px;border:1px solid var(--border)}
  .thumb-label{font-weight:700;margin:4px 0 2px}
  /* ìš´ì†¡ì¥ í…Œì´ë¸” */
  table{width:100%;border-collapse:collapse}
  th,td{border:1px solid #e5e7eb;padding:8px;font-size:14px}
  th{background:#f8fafc}
  /* ë‚´ ìœ„ì¹˜ */
  .my-location{width:12px;height:12px;background:rgba(0,123,255,.95);border-radius:50%;border:2px solid #fff}
</style>
</head>
<body>
<header>ğŸ—º ì‹¤ì‹œê°„ ì§€ë„ - The Listen</header>
<div id="map"></div>

<!-- ë™ ê·¸ë£¹ ì¹´ë“œ -->
<div id="card">
  <div class="card-inner">
    <div id="cardHead" class="title">ê³ ê° ìƒì„¸ ì •ë³´</div>
    <div id="cardAddr" class="muted" style="text-align:center"></div>
    <div class="section-title">ë™ ë‚´ ê³ ê° (ê³ ì¸µâ†’ì €ì¸µ, ì™„ë£Œ í•˜ë‹¨)</div>
    <div id="groupList" class="list"></div>
    <div class="flex"><button class="btn gray" onclick="closeCard()">ë‹«ê¸°</button></div>
  </div>
</div>

<!-- ê³ ê° ìƒì„¸ ì „ì²´ì°½ -->
<div id="detail">
  <div class="detail-inner">
    <h2 id="detailTitle" style="text-align:center;margin-bottom:10px">ê³ ê° ìƒì„¸</h2>
    <div id="detailAddr" class="muted" style="text-align:center;margin-bottom:10px"></div>

    <!-- ì‚¬ì§„ ë¹„êµ -->
    <div class="section-title">ğŸ“¸ ì‚¬ì§„ ë¹„êµ (ê¸ˆì¼ / ì§ì „)</div>
    <div class="thumbs">
      <div class="thumb-box"><div class="thumb-label">ê¸ˆì¼</div><img id="imgToday" alt="ê¸ˆì¼ ì—†ìŒ"></div>
      <div class="thumb-box"><div class="thumb-label">ì§ì „</div><img id="imgPrev" alt="ì§ì „ ì—†ìŒ"></div>
    </div>

    <!-- ê³ ì • ì •ë³´(ì½ê¸°) + ê¸°ì‚¬ ì„ íƒ ì˜ì—­ -->
    <div class="row">
      <div class="col">
        <div class="section-title">ê³µë™í˜„ê´€ ë¹„ë°€ë²ˆí˜¸ (ì½ê¸°)</div>
        <input id="entCode" type="text" disabled placeholder="ê³ ê° ì œê³µ ë¹„ë°€ë²ˆí˜¸(ì½ê¸°)" />
      </div>
      <div class="col">
        <div class="section-title">ë°°ì†¡ìš”ì²­ ë©”ëª¨ (ì½ê¸°)</div>
        <textarea id="reqNote" rows="2" disabled placeholder="ê³ ê° ìš”ì²­ì‚¬í•­(ì½ê¸°)"></textarea>
      </div>
    </div>

    <div class="row">
      <div class="col">
        <div class="section-title">ëŒ€ë©´ë°°ì†¡</div>
        <label><input type="checkbox" id="faceToFace"> ëŒ€ë©´ ì¸ë„(ì²´í¬ ì‹œ ì¹´ë©”ë¼ ë¹„í™œì„±)</label>
      </div>
      <div class="col">
        <div class="section-title">ì¸ìˆ˜ì</div>
        <label><input type="checkbox" id="hasReceiver"> ì¸ìˆ˜ì í™•ì¸</label>
      </div>
    </div>

    <div class="row">
      <div class="col">
        <div class="section-title">ë³´ê´€ ìœ„ì¹˜</div>
        <select id="placeSelect">
          <option value="ë¬¸ì•" selected>ë¬¸ì•</option>
          <option value="ê²½ë¹„ì‹¤">ê²½ë¹„ì‹¤</option>
          <option value="ë¬´ì¸íƒë°°í•¨">ë¬´ì¸íƒë°°í•¨</option>
          <option value="ê´€ë¦¬ì‹¤">ê´€ë¦¬ì‹¤</option>
          <option value="ê³ ê°ìš”ì²­ì¥ì†Œ">ê³ ê°ìš”ì²­ì¥ì†Œ</option>
        </select>
      </div>
      <div class="col">
        <div class="section-title">ê¸°ì‚¬ ë©”ëª¨</div>
        <input id="driverNote" type="text" placeholder="í˜„ì¥ ë©”ëª¨(ì €ì¥ë¨)" />
      </div>
    </div>

    <!-- ìš´ì†¡ì¥ ëª©ë¡ (ì²´í¬â†’ë¶€ë¶„ì™„ë£Œ / ë¯¸ì²´í¬â†’ì „ì²´ì™„ë£Œ) -->
    <div class="section-title">ìš´ì†¡ì¥ ëª©ë¡</div>
    <div class="muted">ì²´í¬ ì—†ìœ¼ë©´ <b>ì „ì²´ ìš´ì†¡ì¥</b> ì™„ë£Œ. ì²´í¬ ì‹œ <b>ì²´í¬ëœ ìš´ì†¡ì¥ë§Œ</b> ì™„ë£Œ ì²˜ë¦¬ë©ë‹ˆë‹¤.</div>
    <div style="overflow:auto"><table id="wbTable">
      <thead><tr><th>ì„ íƒ</th><th>ìš´ì†¡ì¥</th><th>ë°œì†¡ì¸</th><th>ìƒí’ˆëª…</th><th>ê³ ê°€</th></tr></thead>
      <tbody></tbody>
    </table></div>

    <div class="flex" style="margin-top:8px">
      <button class="btn" id="btnPhoto">ğŸ“¸ ì‚¬ì§„ ì´¬ì˜/ì „ì†¡</button>
      <button class="btn green" id="btnComplete">âœ… ë°°ë‹¬ì™„ë£Œ</button>
      <button class="btn gray" onclick="closeDetail()">ë‹«ê¸°</button>
    </div>
  </div>
</div>

<script>
/* ===== Kakao Map Init ===== */
const map = new kakao.maps.Map(document.getElementById("map"),{center:new kakao.maps.LatLng(37.3795,126.806),level:5});
/* ë°ì´í„° ë¡œë“œ */
let deliveries = JSON.parse(localStorage.getItem('deliveriesJSON')||'[]');
if(!deliveries.length){
  // ë…ë¦½ í…ŒìŠ¤íŠ¸ ì‹œë“œ
  const baseLat=37.3795, baseLng=126.806;
  deliveries = Array.from({length:6}).map((_,i)=>{
    const d=101+(i%3)*2, ho=1200-i*3;
    const wb1=`WB-${d}-${ho}`, wb2=`WB-${d}-${ho-1}`;
    return {
      id:`CUST-${d}-${ho}`, name:`í…ŒìŠ¤íŠ¸${i+1}`, phone:`01012${i}3-45${i}6`,
      address:`ê²½ê¸°ë„ ì‹œí¥ì‹œ ìˆ˜í’€ì•ˆê¸¸ 19-30 ${d}ë™ ${ho}í˜¸`,
      lat:baseLat+(Math.random()-0.5)*0.01, lng:baseLng+(Math.random()-0.5)*0.01,
      order:i+1, waybills:[wb1, wb2], boxes:2,
      products:{ [wb1]:{sender:'ì‹œë“œí™”ì£¼',item:'ì‹œë“œ1',highValue:false}, [wb2]:{sender:'ì‹œë“œí™”ì£¼',item:'ì‹œë“œ2',highValue:(i%2===0)} }
    };
  });
}
/* ë‚´ ìœ„ì¹˜ */
let myCircle=null;
if(navigator.geolocation){
  navigator.geolocation.watchPosition(pos=>{
    const now=new kakao.maps.LatLng(pos.coords.latitude,pos.coords.longitude);
    if(!myCircle) myCircle=new kakao.maps.CustomOverlay({map,position:now,content:'<div class="my-location"></div>'});
    else myCircle.setPosition(now);
  });
}

/* íŒŒì„œ & ìƒ‰ìƒ */
function parseDongHo(addr=""){
  const n=addr.replace(/\s+/g,' ');
  let m=n.match(/(\d{1,4})\s*ë™[^0-9]*(\d{1,4})\s*í˜¸/); if(m) return {dong:m[1],ho:+m[2]};
  m=n.match(/(\d{3,4})\s*[-]\s*(\d{1,4})/); if(m) return {dong:m[1],ho:+m[2]};
  m=n.match(/([A-Zê°€-í£]+)\s*ë™/); if(m) return {dong:m[1],ho:0};
  const nums=(n.match(/(\d{2,4})/g)||[]); if(nums.length>=2) return {dong:nums.at(-2),ho:+nums.at(-1)};
  return {dong:'0',ho:0};
}
const colorMap=new Map(),palette=["#007bff","#10b981","#f59e0b","#8b5cf6","#ef4444","#14b8a6","#f97316"];
function colorForDong(d){if(!colorMap.has(d))colorMap.set(d,palette[(d.charCodeAt(0)%palette.length)]);return colorMap.get(d);}
const keyComp='completedWBs';           // [{waybill, custId, date}]
const keyPhotosWB=wb=>`photos_wb_${wb}`; // ìš´ì†¡ì¥ ë‹¨ìœ„ ì‚¬ì§„
const keyNotes=id=>`notes_${id}`;        // ê³ ê° ë‹¨ìœ„ ë©”ëª¨(ì½ê¸°)

/* ë§ˆì»¤ = ë°•ìŠ¤ ìˆ˜ëŸ‰ */
const mkByCustId={}, elByCustId={}, bounds=new kakao.maps.LatLngBounds();
deliveries.forEach(d=>{
  const {dong}=parseDongHo(d.address);const col=colorForDong(String(dong));
  const el=document.createElement('div');
  el.style.cssText=`width:34px;height:34px;background:${col};color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:900;border:2px solid #fff;cursor:pointer`;
  el.textContent=d.boxes; // ë°•ìŠ¤ìˆ˜ëŸ‰
  const mk=new kakao.maps.CustomOverlay({map,position:new kakao.maps.LatLng(d.lat,d.lng),content:el});
  mkByCustId[d.id]=mk; elByCustId[d.id]=el; bounds.extend(new kakao.maps.LatLng(d.lat,d.lng));
  // ëª¨ë“  ìš´ì†¡ì¥ ì™„ë£Œ ì‹œ ë°˜íˆ¬ëª…
  if(isAllWaybillsCompleted(d)) el.style.opacity='0.4';
  el.onclick=()=>openCardForDong(d);
});
if(!bounds.isEmpty()) map.setBounds(bounds);

/* ì™„ë£Œ íŒë‹¨: ê³ ê°ì˜ ëª¨ë“  waybillì´ ì™„ë£ŒëëŠ”ê°€ */
function isAllWaybillsCompleted(cust){
  const comp = JSON.parse(localStorage.getItem(keyComp)||'[]');
  return cust.waybills.every(wb=>comp.some(x=>x.waybill===wb));
}

/* ë™ ê·¸ë£¹ ì¹´ë“œ */
const card=document.getElementById('card'),cardHead=document.getElementById('cardHead'),cardAddr=document.getElementById('cardAddr'),groupList=document.getElementById('groupList');
let currentDong=null,currentMain=null,currentGroup=[];
function openCardForDong(d){
  const {dong}=parseDongHo(d.address);currentDong=dong;currentMain=d;
  const doneMap = new Map(JSON.parse(localStorage.getItem(keyComp)||'[]').map(x=>[x.waybill,true]));
  let grp = deliveries.filter(v=>parseDongHo(v.address).dong===dong);
  // ì™„ë£Œëœ ê³ ê°(=ëª¨ë“  waybill ì™„ë£Œ)ì€ í•˜ë‹¨
  grp.sort((a,b)=>{
    const A=isAllWaybillsCompleted(a), B=isAllWaybillsCompleted(b);
    if(A&&!B) return 1; if(!A&&B) return -1;
    return parseDongHo(b.address).ho - parseDongHo(a.address).ho;
  });
  currentGroup=grp;
  cardHead.textContent=`${dong}ë™ ê³ ê° (${grp.length}ê±´)`;cardAddr.textContent=d.address;
  groupList.innerHTML=grp.map(x=>{
    const p=parseDongHo(x.address),col=colorForDong(String(p.dong));
    const op=isAllWaybillsCompleted(x)?'opacity:.5;':'';
    return `<div class="item" data-id="${x.id}" style="${op}">
      <div class="line1"><span class="badge" style="background:${col}">${x.boxes}</span>
      <div style="flex:1"><b>${x.name}</b> Â· ${x.phone}<br>
      <span class="muted">${x.address}</span></div>
      <span class="muted">ìš´ì†¡ì¥ ${x.waybills.length}ê°œ</span></div></div>`;
  }).join('');
  groupList.querySelectorAll('.item').forEach(el=>{
    el.onclick=()=>{const id=el.dataset.id;const t=currentGroup.find(v=>v.id===id);if(t)openDetail(t);};
  });
  card.classList.add('active');
}
function closeCard(){card.classList.remove('active');}

/* ìƒì„¸ ê³ ê° ì¹´ë“œ */
const detail=document.getElementById('detail');
const imgToday=document.getElementById('imgToday'), imgPrev=document.getElementById('imgPrev');
const entCode=document.getElementById('entCode'), reqNote=document.getElementById('reqNote');
const faceToFace=document.getElementById('faceToFace'), hasReceiver=document.getElementById('hasReceiver');
const placeSelect=document.getElementById('placeSelect'), driverNote=document.getElementById('driverNote');
const wbTable=document.getElementById('wbTable').querySelector('tbody');
const btnPhoto=document.getElementById('btnPhoto'), btnComplete=document.getElementById('btnComplete');
let sel=null;

function openDetail(c){
  sel=c;
  document.getElementById('detailTitle').textContent = `${c.name} (${c.phone})`;
  document.getElementById('detailAddr').textContent  = `${c.address}`;
  // ì½ê¸° ë…¸íŠ¸ ë¡œë“œ(ê³ ê° ë‹¨ìœ„)
  const notes=JSON.parse(localStorage.getItem(keyNotes(c.id))||'{}');
  entCode.value = notes.entCode||''; reqNote.value = notes.reqNote||'';
  // ê¸°ì‚¬ ì„ íƒ ì´ˆê¸°ê°’
  faceToFace.checked=false; hasReceiver.checked=false;
  placeSelect.value='ë¬¸ì•'; driverNote.value='';
  // ìš´ì†¡ì¥ í…Œì´ë¸”
  renderWaybillTable(c);
  // ì‚¬ì§„ ë¹„êµ(ìš´ì†¡ì¥ ìµœê·¼ ì‚¬ì§„ 1ì¥ì„ ëŒ€í‘œë¡œ - ê°€ì¥ ìµœê·¼ ì—…ë¡œë“œê°€ ìˆëŠ” ìš´ì†¡ì¥ ê¸°ì¤€)
  loadPhotoCompare(c);
  // ì¹´ë©”ë¼ ë²„íŠ¼ í† ê¸€(ëŒ€ë©´ë°°ì†¡ ì²´í¬ ì‹œ ë¹„í™œì„±)
  applyPhotoEnableRule();
  detail.classList.add('active');
}
function closeDetail(){ detail.classList.remove('active'); }

function renderWaybillTable(c){
  const comp = JSON.parse(localStorage.getItem(keyComp)||'[]');
  wbTable.innerHTML = c.waybills.map(wb=>{
    const p=c.products?.[wb]||{sender:'ë¯¸ìƒ',item:'ì¼ë°˜',highValue:false};
    const done = comp.some(x=>x.waybill===wb);
    return `<tr data-wb="${wb}" style="${done?'opacity:.5;':''}">
      <td style="text-align:center"><input type="checkbox" ${done?'disabled':''}></td>
      <td>${wb}</td><td>${p.sender||''}</td><td>${p.item||''}</td><td>${p.highValue?'ğŸ”´':''}</td>
    </tr>`;
  }).join('');
}

/* ëŒ€í‘œ ì‚¬ì§„ ë¹„êµ ë¡œë”©: ê¸ˆì¼/ì§ì „ (ìš´ì†¡ì¥ ë‹¨ìœ„ë¡œ ì €ì¥ë¨) */
function loadPhotoCompare(c){
  // ê³ ê°ì˜ ëª¨ë“  ìš´ì†¡ì¥ ì¤‘ ê°€ì¥ ìµœê·¼ ì—…ë¡œë“œê°€ ìˆëŠ” ê²ƒì„ ê³¨ë¼ì„œ ëŒ€í‘œ ë¹„êµ
  let latest = null;
  c.waybills.forEach(wb=>{
    const arr = JSON.parse(localStorage.getItem(keyPhotosWB(wb))||'[]');
    if(arr.length && (!latest || arr[0].ts > latest.ts)){
      latest = { wb, arr };
    }
  });
  if(latest){
    imgToday.src = latest.arr[0]?.data||'';
    imgPrev.src  = latest.arr[1]?.data||'';
  }else{
    imgToday.src=''; imgPrev.src='';
  }
}

/* ì¹´ë©”ë¼ ë²„íŠ¼ í™œì„± ê·œì¹™ */
function applyPhotoEnableRule(){
  // ëŒ€ë©´ë°°ì†¡ ì²´í¬ì‹œ: ì¹´ë©”ë¼ ë¹„í™œì„±
  btnPhoto.disabled = !!faceToFace.checked;
}
faceToFace.onchange = applyPhotoEnableRule;

/* ì‚¬ì§„ ì´¬ì˜/ì „ì†¡
 * ì²´í¬ëœ ìš´ì†¡ì¥ë§Œ ì „ì†¡ â†’ í•´ë‹¹ ìš´ì†¡ì¥ í‚¤ì— ì €ì¥
 * ì•„ë¬´ê²ƒë„ ì²´í¬ ì•ˆ í•˜ë©´ ê³ ê°ì˜ ëª¨ë“  ë¯¸ì™„ ìš´ì†¡ì¥ì— ë™ì¼ ì‚¬ì§„ ì €ì¥(ì™„ë£Œ ì²˜ë¦¬ ì „ ë‹¨ê³„)
 */
btnPhoto.onclick = ()=>{
  if(!sel) return;
  const rows=[...wbTable.querySelectorAll('tr')];
  const targetWBs = rows.filter(tr=>tr.querySelector('input[type=checkbox]')?.checked)
                        .map(tr=>tr.dataset.wb);
  const comp = JSON.parse(localStorage.getItem(keyComp)||'[]');
  const remaining = sel.waybills.filter(wb=>!comp.some(x=>x.waybill===wb));
  const wbList = targetWBs.length? targetWBs : remaining;
  if(wbList.length===0){ alert('ì´ë¯¸ ëª¨ë“  ìš´ì†¡ì¥ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.'); return; }

  const i=document.createElement('input'); i.type='file'; i.accept='image/*'; i.capture='environment';
  i.onchange=e=>{
    const f=e.target.files?.[0]; if(!f) return;
    const r=new FileReader();
    r.onload=()=>{
      wbList.forEach(wb=>{
        const arr = JSON.parse(localStorage.getItem(keyPhotosWB(wb))||'[]');
        arr.unshift({ts:Date.now(),data:r.result});
        localStorage.setItem(keyPhotosWB(wb), JSON.stringify(arr));
      });
      alert(`ğŸ“¸ ì‚¬ì§„ ì €ì¥ ì™„ë£Œ (${wbList.length}ê±´)`);
      loadPhotoCompare(sel); // ëŒ€í‘œ ë¹„êµ ê°±ì‹ 
    };
    r.readAsDataURL(f);
  };
  i.click();
};

/* ì™„ë£Œ ì²˜ë¦¬
 * ì²´í¬ëœ ìš´ì†¡ì¥ë§Œ ì™„ë£Œ, ì—†ìœ¼ë©´ ì „ì²´ ë¯¸ì™„ ìš´ì†¡ì¥ ì™„ë£Œ
 * ëª¨ë“  ìš´ì†¡ì¥ ì™„ë£Œ ì‹œ ë§ˆì»¤ ë°˜íˆ¬ëª… & ë°•ìŠ¤ìˆ˜ëŸ‰ 0 í‘œê¸°(ë˜ëŠ” ìœ ì§€)
 */
btnComplete.onclick = ()=>{
  if(!sel) return;
  const rows=[...wbTable.querySelectorAll('tr')];
  let pick = rows.filter(tr=>tr.querySelector('input[type=checkbox]')?.checked).map(tr=>tr.dataset.wb);

  const comp = JSON.parse(localStorage.getItem(keyComp)||'[]');
  const remaining = sel.waybills.filter(wb=>!comp.some(x=>x.waybill===wb));
  if(pick.length===0) pick = remaining;

  if(pick.length===0){ alert('ì™„ë£Œí•  ìš´ì†¡ì¥ì´ ì—†ìŠµë‹ˆë‹¤.'); return; }

  // ì™„ë£Œ ê¸°ë¡
  const now = new Date().toISOString();
  pick.forEach(wb=>{ comp.push({waybill:wb, custId:sel.id, date:now}); });
  localStorage.setItem(keyComp, JSON.stringify(comp));

  // UI ê°±ì‹ : í…Œì´ë¸”, ë§ˆì»¤, ê·¸ë£¹ì¹´ë“œ
  renderWaybillTable(sel);
  // ë°•ìŠ¤ ìˆ˜ëŸ‰ = ì „ì²´ - ì™„ë£Œìˆ˜
  const doneCnt = sel.waybills.filter(wb=>comp.some(x=>x.waybill===wb)).length;
  const remain  = sel.waybills.length - doneCnt;
  elByCustId[sel.id].textContent = remain>0? remain : '0';
  if(remain===0) elByCustId[sel.id].style.opacity='0.4';

  alert(`âœ… ì™„ë£Œ ì²˜ë¦¬: ${pick.length}ê±´`);
  // ê·¸ë£¹ ì¹´ë“œ ìƒˆë¡œ ê·¸ë¦¼
  if(currentMain) openCardForDong(currentMain);
};

/* ë„¤ë¹„(ì˜µì…˜)
function navTo(addr,lat,lng){
  const appURL=`kakaomap://route?ep=${lat},${lng}&by=CAR`;
  const webURL=`https://map.kakao.com/link/to/${encodeURIComponent(addr)},${lat},${lng}`;
  location.href=appURL; setTimeout(()=>location.href=webURL, 1000);
}
*/

function closeDetail(){ detail.classList.remove('active'); }
function closeCard(){ card.classList.remove('active'); }
/* ë§ˆì»¤ í´ë¦­ ì‹œ ìƒì„¸ */
function openDetail(c){ /* ìœ„ì— ì •ì˜ë¨ */ detail.classList.add('active'); }
</script>
</body>
</html>
