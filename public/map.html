<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>ğŸšš The Listen - AI ê²½ë¡œ ìë™ ì •ë ¬ ë°°ì†¡ê´€ë¦¬</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: 'Noto Sans KR', sans-serif;
      background-color: #f5f5f5;
    }

    header {
      background-color: #007bff;
      color: white;
      text-align: center;
      padding: 14px 0;
      font-size: 1.4rem;
      font-weight: 600;
      z-index: 10;
      position: relative;
    }

    #map {
      width: 100%;
      height: 45%;
    }

    #gps-toggle {
      position: absolute;
      bottom: 20px;
      right: 20px;
      width: 54px;
      height: 54px;
      border-radius: 50%;
      background-color: white;
      border: 2px solid #007bff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.25);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 20;
      transition: 0.3s;
    }
    #gps-toggle.active { background-color: #007bff; }
    #gps-toggle svg {
      width: 26px;
      height: 26px;
      fill: #007bff;
      transition: 0.3s;
    }
    #gps-toggle.active svg { fill: white; }

    /* ğŸšš ë°°ì†¡ ì¹´ë“œ ì˜ì—­ */
    #delivery-list {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 55%;
      background: white;
      border-top-left-radius: 12px;
      border-top-right-radius: 12px;
      overflow-y: auto;
      box-shadow: 0 -3px 8px rgba(0,0,0,0.2);
      padding: 10px;
    }

    .card {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      padding: 10px 12px;
      margin-bottom: 8px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      font-size: 14px;
    }

    .card strong {
      color: #007bff;
      font-weight: 600;
    }

    .card .top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .card button {
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 4px 10px;
      font-size: 12px;
      cursor: pointer;
    }

    #result-info {
      font-size: 12px;
      text-align: center;
      color: #666;
      margin-bottom: 8px;
    }
  </style>
</head>
<body>
  <header>ğŸš› The Listen AIÂ·GPS ìë™ ê²½ë¡œ ì •ë ¬</header>
  <div id="map"></div>

  <!-- GPS í† ê¸€ -->
  <div id="gps-toggle" title="GPS ìœ„ì¹˜ ì¶”ì  í† ê¸€">
    <svg viewBox="0 0 24 24">
      <path d="M12 8a4 4 0 100 8 4 4 0 000-8zm9 3h-1.07a7.002 7.002 0 00-5.93-5.93V4a1 1 0 10-2 0v1.07a7.002 7.002 0 00-5.93 5.93H3a1 1 0 100 2h1.07a7.002 7.002 0 005.93 5.93V20a1 1 0 102 0v-1.07a7.002 7.002 0 005.93-5.93H21a1 1 0 100-2zm-9 5a5 5 0 110-10 5 5 0 010 10z"/>
    </svg>
  </div>

  <!-- ë°°ì†¡ ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ -->
  <div id="delivery-list">
    <div id="result-info">ğŸ“ GPS í™œì„±í™” í›„ AI ê²½ë¡œ ìµœì í™” ìˆœì„œ ìë™ ì •ë ¬ ì¤‘...</div>
    <div id="card-container"></div>
  </div>

  <!-- Kakao Map SDK -->
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=301ef23f56e23f0dee3eaf47fe734b03"></script>
  <script>
    const deliveryPoints = [
      { waybill: "A001", name: "ê¹€ì² ìˆ˜", phone: "010-1234-5678", address: "ì„œìš¸íŠ¹ë³„ì‹œ ì¤‘êµ¬ ì„¸ì¢…ëŒ€ë¡œ 110", lat: 37.5665, lng: 126.9780 },
      { waybill: "A002", name: "ì´ì˜í¬", phone: "010-2345-6789", address: "ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 201", lat: 37.4979, lng: 127.0276 },
      { waybill: "A003", name: "ë°•ë¯¼ìˆ˜", phone: "010-3456-7890", address: "ì„œìš¸íŠ¹ë³„ì‹œ ì†¡íŒŒêµ¬ ì˜¬ë¦¼í”½ë¡œ 326", lat: 37.5145, lng: 127.1059 },
      { waybill: "A004", name: "ì •í•˜ëŠ˜", phone: "010-4567-8901", address: "ì„œìš¸íŠ¹ë³„ì‹œ êµ¬ë¡œêµ¬ ë””ì§€í„¸ë¡œ 32", lat: 37.4843, lng: 126.9011 },
      { waybill: "A005", name: "í™ê¸¸ë™", phone: "010-6789-0123", address: "ì„œìš¸íŠ¹ë³„ì‹œ ì„œì´ˆêµ¬ ì„œì´ˆëŒ€ë¡œ 74ê¸¸", lat: 37.4949, lng: 127.0145 },
      { waybill: "A006", name: "ìµœì€ì§€", phone: "010-9876-5432", address: "ì„œìš¸íŠ¹ë³„ì‹œ ë§ˆí¬êµ¬ ì›”ë“œì»µë¶ë¡œ 400", lat: 37.5690, lng: 126.9017 }
    ];

    let map, gpsWatchId = null, userCircle = null;

    function calculateDistance(lat1, lng1, lat2, lng2) {
      const R = 6371; // km
      const dLat = (lat2 - lat1) * Math.PI / 180;
      const dLng = (lng2 - lng1) * Math.PI / 180;
      const a = Math.sin(dLat / 2) ** 2 + Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLng / 2) ** 2;
      return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    }

    function renderCards(list) {
      const container = document.getElementById("card-container");
      container.innerHTML = "";
      list.forEach((p, idx) => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <div class="top">
            <strong>${idx + 1}ï¸âƒ£ ${p.name}</strong>
            <button onclick="alert('ê³ ê°ì—ê²Œ ì „í™” ì—°ê²°: ${p.phone}')">ğŸ“ ì „í™”</button>
          </div>
          <div><b>ìš´ì†¡ì¥:</b> ${p.waybill}</div>
          <div><b>ì£¼ì†Œ:</b> ${p.address}</div>
          <div><b>ê±°ë¦¬:</b> ${p.distance ? p.distance.toFixed(2) + " km" : "-"}</div>
        `;
        container.appendChild(card);
      });
    }

    window.onload = function() {
      const mapContainer = document.getElementById("map");
      const mapOption = { center: new kakao.maps.LatLng(37.5665, 126.9780), level: 7 };
      map = new kakao.maps.Map(mapContainer, mapOption);

      const bounds = new kakao.maps.LatLngBounds();
      deliveryPoints.forEach(p => {
        const pos = new kakao.maps.LatLng(p.lat, p.lng);
        new kakao.maps.Marker({ map, position: pos });
        bounds.extend(pos);
      });
      map.setBounds(bounds);

      const gpsBtn = document.getElementById("gps-toggle");
      const info = document.getElementById("result-info");
      renderCards(deliveryPoints); // ì´ˆê¸° í‘œì‹œ

      gpsBtn.addEventListener("click", () => {
        if (gpsBtn.classList.contains("active")) {
          gpsBtn.classList.remove("active");
          if (gpsWatchId) navigator.geolocation.clearWatch(gpsWatchId);
          if (userCircle) userCircle.setMap(null);
          userCircle = null;
          info.textContent = "ğŸ“ GPS ì¤‘ì§€ë¨";
        } else {
          gpsBtn.classList.add("active");
          if (navigator.geolocation) {
            gpsWatchId = navigator.geolocation.watchPosition((pos) => {
              const myLat = pos.coords.latitude;
              const myLng = pos.coords.longitude;
              const loc = new kakao.maps.LatLng(myLat, myLng);

              if (!userCircle) {
                userCircle = new kakao.maps.Circle({
                  center: loc,
                  radius: 8,
                  strokeWeight: 0,
                  fillColor: "#1E90FF",
                  fillOpacity: 1
                });
                userCircle.setMap(map);
              } else {
                userCircle.setPosition(loc);
              }

              map.setCenter(loc);

              const sorted = deliveryPoints.map(p => ({
                ...p,
                distance: calculateDistance(myLat, myLng, p.lat, p.lng)
              })).sort((a, b) => a.distance - b.distance);

              info.textContent = "ğŸš› ê°€ê¹Œìš´ ìˆœì„œë¡œ ìë™ ì •ë ¬ ì¤‘...";
              renderCards(sorted);
            }, () => {
              alert("GPS ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
            }, { enableHighAccuracy: true });
          } else {
            alert("ì´ ê¸°ê¸°ëŠ” GPSë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
          }
        }
      });
    };
  </script>
</body>
</html>
