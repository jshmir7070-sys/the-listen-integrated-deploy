<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ìš´ì†¡ì¥ ì…ë ¥ - The Listen</title>
<script src="https://cdn.jsdelivr.net/npm/@zxing/library@0.20.0/umd/index.min.js"></script>
<style>
body{margin:0;background:#f7f9fc;font-family:"Noto Sans KR",sans-serif}
header{background:#007bff;color:#fff;text-align:center;padding:12px;font-weight:900}
.wrap{max-width:480px;margin:auto;padding:14px}
input{flex:1;padding:12px;font-size:16px;border:1px solid #ccc;border-radius:10px}
button{padding:12px 14px;border:none;border-radius:10px;font-weight:700;color:#fff;background:#007bff;cursor:pointer}
video{width:100%;border-radius:10px;background:#000;margin-top:10px}
.card{background:#fff;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.08);padding:12px;margin-top:10px}
.customer{border-bottom:1px solid #eee;padding:8px 0}
.customer:last-child{border-bottom:none}
.high{color:#ef4444;font-weight:700}
</style>
</head>
<body>
<header>ğŸ“¦ ìš´ì†¡ì¥ ë“±ë¡ (The Listen)</header>
<div class="wrap">
  <div style="display:flex;gap:6px">
    <input id="waybillInput" type="number" inputmode="numeric" placeholder="ìš´ì†¡ì¥ ë²ˆí˜¸ ì…ë ¥" />
    <button id="scanBtn">ğŸ“¸</button>
  </div>
  <button style="width:100%;margin-top:8px" id="addBtn">ì¶”ê°€</button>
  <video id="preview" playsinline muted></video>

  <div class="card">
    <h3>ê³ ê° ì •ë³´</h3>
    <div id="list"></div>
  </div>

  <button style="width:100%;margin-top:12px;background:#6b7280" id="backBtn">â¬…ï¸ ì¶œë°œ í˜ì´ì§€ë¡œ</button>
</div>

<script>
const reader=new ZXing.BrowserMultiFormatReader();
const listDiv=document.getElementById('list');
const customers=JSON.parse(localStorage.getItem('waybillCustomers')||'[]');

document.getElementById('scanBtn').onclick=()=>{
  reader.decodeFromVideoDevice(null,document.getElementById('preview'),(res,err)=>{
    if(res){ add(res.text); reader.reset(); }
  });
};
document.getElementById('addBtn').onclick=()=>{
  const num=document.getElementById('waybillInput').value.trim();
  if(!num) return alert('ìš´ì†¡ì¥ ë²ˆí˜¸ ì…ë ¥');
  add(num);
  document.getElementById('waybillInput').value='';
};

function add(num){
  const high=Math.random()<0.1;
  const obj={
    id:num,
    name:`ì¡°ë‚¨ê³ ê°${customers.length+1}`,
    address:`ê²½ê¸°ë„ ì‹œí¥ì‹œ ì¡°ë‚¨ë™ ${100+(customers.length%20)}ë™ ${200+customers.length}í˜¸`,
    phone:`010-${1000+customers.length}-${2000+customers.length}`,
    boxes:1+(customers.length%3),
    lat:37.3795+(Math.random()-0.5)*0.01,
    lng:126.806+(Math.random()-0.5)*0.01,
    highValue:high
  };
  customers.unshift(obj);
  render();
  localStorage.setItem('waybillCustomers',JSON.stringify(customers));
}

function render(){
  listDiv.innerHTML=customers.map(c=>
    `<div class="customer ${c.highValue?'high':''}">
      <b>${c.name}</b> - ${c.address}<br>
      ğŸ“¦ ${c.id} / ë°•ìŠ¤ ${c.boxes}ê°œ ${c.highValue?'(ê³ ê°€í’ˆ)': ''}
    </div>`
  ).join('');
}

document.getElementById('backBtn').onclick=()=>location.href='depart.html';
render();
</script>
</body>
</html>
