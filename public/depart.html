<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ë°°ì†¡ì¶œë°œ - ìŠ¤ìº”</title>
<script src="https://cdn.jsdelivr.net/npm/@zxing/library@0.20.0/umd/index.min.js"></script>
<style>
  body{margin:0;background:#f7f9fc;font-family:"Noto Sans KR",sans-serif}
  header{background:#007bff;color:#fff;text-align:center;padding:12px;font-weight:800}
  .wrap{max-width:920px;margin:14px auto;padding:0 12px}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
  .card{background:#fff;border-radius:16px;box-shadow:0 10px 28px rgba(0,0,0,.06);padding:14px}
  h3{margin:8px 0 10px}
  input[type="text"]{width:100%;padding:12px;border:1px solid #e5e7eb;border-radius:10px;font-size:15px}
  .btn{background:#007bff;color:#fff;border:none;border-radius:10px;padding:10px 12px;cursor:pointer;font-weight:700}
  .btn.gray{background:#6b7280}.btn.red{background:#ef4444}
  .row{margin:8px 0}.btnRow{display:flex;gap:8px;flex-wrap:wrap}
  .list{max-height:48vh;overflow:auto;border:1px solid #eef2f7;border-radius:12px;padding:8px}
  .item{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #f1f5f9;padding:8px 4px}
  .count{font-weight:900;font-size:18px}
  .camWrap{position:relative;border-radius:12px;overflow:hidden;background:#000}
  video{width:100%;height:auto;display:block}
  .guide{position:absolute;left:0;right:0;top:50%;transform:translateY(-50%);height:2px;background:rgba(0,123,255,.9);box-shadow:0 0 12px rgba(0,123,255,.6)}
</style>
</head>
<body>
<header>ğŸšš ë°°ì†¡ì¶œë°œ (ìŠ¤ìº” ìˆ˜ëŸ‰ë§Œ í‘œê¸°)</header>
<div class="wrap">
  <div class="grid">
    <div class="card">
      <h3>ğŸ“¸ ì¹´ë©”ë¼ ë°”ì½”ë“œ ìŠ¤ìº”</h3>
      <div class="camWrap">
        <video id="preview" muted playsinline></video>
        <div class="guide"></div>
      </div>
      <div class="row btnRow" style="margin-top:10px;">
        <button class="btn" id="btnStart">ì¹´ë©”ë¼ ì‹œì‘(í›„ë©´)</button>
        <button class="btn gray" id="btnStop">ì •ì§€</button>
        <button class="btn" id="btnTorch" style="display:none;">í”Œë˜ì‹œ</button>
      </div>
    </div>
    <div class="card">
      <h3>ğŸ”¢ ìŠ¤ìº” ëª©ë¡ <span class="count" id="scanCount">0</span> ê±´</h3>
      <div class="row"><input id="scanInput" type="text" placeholder="ìŠ¤ìºë„ˆ/ìˆ˜ê¸° ì…ë ¥(ì—”í„°)" /></div>
      <div class="btnRow">
        <button class="btn" id="btnAdd">ì¶”ê°€</button>
        <button class="btn gray" id="btnClear">ì „ì²´ ì´ˆê¸°í™”</button>
        <button class="btn" onclick="goMap()">ğŸ§­ ì§€ë„ë¡œ ì´ë™(ìµœì ê²½ë¡œ)</button>
      </div>
      <div class="list" id="list"></div>
    </div>
  </div>
</div>
<script>
const $scanInput=document.getElementById('scanInput');
const $scanCount=document.getElementById('scanCount');
const $list=document.getElementById('list');
let scanList=JSON.parse(localStorage.getItem('scanList')||'[]');

function render(){ $list.innerHTML=scanList.map((c,i)=>`<div class="item"><b>${c}</b><button class="btn red" onclick="rm(${i})">ì‚­ì œ</button></div>`).join(''); $scanCount.textContent=scanList.length; localStorage.setItem('scanList',JSON.stringify(scanList)); localStorage.setItem('scanned',String(scanList.length)); }
function add(v){ v=(v||'').trim(); if(!v) return; scanList.unshift(v); render(); }
function rm(i){ scanList.splice(i,1); render(); }
function clearAll(){ scanList=[]; render(); }
window.rm=rm; render();
$scanInput.focus(); setInterval(()=>{ if(document.activeElement!==$scanInput) $scanInput.focus(); },1500);
document.getElementById('btnAdd').onclick=()=>{ add($scanInput.value); $scanInput.value=''; };
$scanInput.addEventListener('keydown',e=>{ if(e.key==='Enter'){ add($scanInput.value); $scanInput.value=''; }});
document.getElementById('btnClear').onclick=clearAll;
function goMap(){ localStorage.setItem('optimizeByGPS','1'); location.href='map.html'; }

// ZXing
const codeReader=new ZXing.BrowserMultiFormatReader(); let currentStream=null; let torchOn=false;
async function startCam(){ try{ const devices=await ZXing.BrowserCodeReader.listVideoInputDevices(); const back=devices.find(d=>/back|í›„ë©´|environment/i.test(d.label))?.deviceId||devices?.[devices.length-1]?.deviceId; const v=document.getElementById('preview'); await codeReader.decodeFromVideoDevice(back,v,(res,err)=>{ if(res) add(res.getText()); }); currentStream=v.srcObject; const track=currentStream?.getVideoTracks?.()[0]; document.getElementById('btnTorch').style.display=(track?.getCapabilities?.().torch?'inline-block':'none'); }catch(e){ alert('ì¹´ë©”ë¼ ê¶Œí•œ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.'); } }
function stopCam(){ codeReader.reset(); const v=document.getElementById('preview'); const s=v.srcObject; if(s){ s.getTracks().forEach(t=>t.stop()); v.srcObject=null; } currentStream=null; }
function torch(){ const track=currentStream?.getVideoTracks?.()[0]; if(!track) return; const caps=track.getCapabilities?.(); if(!caps?.torch) return; torchOn=!torchOn; track.applyConstraints({advanced:[{torch:torchOn}]}); }
btnStart.onclick=startCam; btnStop.onclick=stopCam; btnTorch.onclick=torch;
</script>
</body>
</html>
