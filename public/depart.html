<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ë°°ì†¡ì¶œë°œ</title>
<script src="https://cdn.jsdelivr.net/npm/@zxing/library@0.20.0/umd/index.min.js"></script>
<style>
  body {
    margin: 0;
    background: #f7f9fc;
    font-family: "Noto Sans KR", sans-serif;
  }
  header {
    background: #007bff;
    color: #fff;
    text-align: center;
    padding: 12px;
    font-weight: 800;
    font-size: 1.2rem;
  }
  .wrap {
    max-width: 960px;
    margin: 16px auto;
    padding: 0 14px;
  }
  .grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
  }
  .card {
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 10px 28px rgba(0, 0, 0, 0.06);
    padding: 14px;
  }
  input[type="text"] {
    width: 100%;
    padding: 14px;
    border: 1px solid #e5e7eb;
    border-radius: 10px;
    font-size: 18px;
    text-align: center;
  }
  input:focus {
    outline: 2px solid #007bff;
  }
  .btn {
    background: #007bff;
    color: #fff;
    border: none;
    border-radius: 10px;
    padding: 10px 12px;
    cursor: pointer;
    font-weight: 700;
  }
  .btn.gray {
    background: #6b7280;
  }
  .btn.red {
    background: #ef4444;
  }
  .btnRow {
    display: flex;
    gap: 10px;
    margin-top: 10px;
    flex-wrap: wrap;
  }
  .list {
    max-height: 400px;
    overflow-y: auto;
    border: 1px solid #eef2f7;
    border-radius: 12px;
    padding: 8px;
  }
  .item {
    border-bottom: 1px solid #f1f5f9;
    padding: 8px 6px;
    cursor: pointer;
  }
  .item:hover {
    background: #f1f5f9;
  }
  .count {
    font-weight: 900;
    font-size: 20px;
  }
  .camWrap {
    position: relative;
    border-radius: 12px;
    overflow: hidden;
    background: #000;
  }
  video {
    width: 100%;
    height: auto;
    display: block;
  }
  .guide {
    position: absolute;
    left: 0;
    right: 0;
    top: 50%;
    transform: translateY(-50%);
    height: 2px;
    background: rgba(0, 123, 255, 0.9);
    box-shadow: 0 0 12px rgba(0, 123, 255, 0.6);
  }
  .iconBtn {
    font-size: 24px;
    background: #fff;
    border: none;
    cursor: pointer;
  }
  .bottomBtns {
    display: flex;
    gap: 12px;
    justify-content: center;
    margin-top: 16px;
  }
  #customerCard {
    max-height: 320px;
    overflow-y: auto;
    padding: 8px;
    border: 1px solid #eee;
    border-radius: 12px;
    background: #fff;
  }
  #customerCard .item {
    padding: 8px 0;
    border-bottom: 1px solid #f3f4f6;
  }
</style>
</head>

<body>
<header>ë°°ì†¡ì¶œë°œ</header>

<div class="wrap">
  <div class="grid">
    <!-- ì™¼ìª½ : ìŠ¤ìº”/ì…ë ¥ -->
    <div class="card">
      <div style="display:flex;gap:6px;">
        <input id="scanInput" type="text" inputmode="numeric" placeholder="ìš´ì†¡ì¥ë²ˆí˜¸ ì…ë ¥ ë˜ëŠ” ìŠ¤ìº”" />
        <button class="iconBtn" id="btnCamera">ğŸ“¸</button>
      </div>

      <div class="btnRow">
        <button class="btn" id="btnAdd">ì¶”ê°€</button>
        <button class="btn gray" id="btnClear">ì´ˆê¸°í™”</button>
      </div>

      <div class="camWrap" id="cameraArea" style="display:none;margin-top:10px;">
        <video id="preview" muted playsinline></video>
        <div class="guide"></div>
        <button class="btn gray" id="btnStop" style="position:absolute;bottom:6px;right:6px;">ì •ì§€</button>
      </div>
    </div>

    <!-- ì˜¤ë¥¸ìª½ : ìŠ¤ìº”ëª©ë¡ -->
    <div class="card">
      <h3>ğŸ“¦ ìŠ¤ìº” ëª©ë¡ <span class="count" id="scanCount">0</span> ê±´</h3>
      <div class="list" id="list"></div>
      <div class="bottomBtns">
        <button class="btn" id="btnOptimize">ğŸ§­ ê²½ë¡œ ìµœì í™”</button>
        <button class="btn" id="btnStart">ğŸš€ ì¶œë°œ ì „ì†¡</button>
      </div>
    </div>
  </div>

  <!-- ê³ ê° ì •ë³´ ì¹´ë“œ -->
  <div class="card" style="margin-top:18px;">
    <h3>ğŸ‘¤ ê³ ê° ì •ë³´</h3>
    <div id="customerCard">ìŠ¤ìº” ì‹œ ê³ ê°ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>
  </div>
</div>

<script>
const scanInput=document.getElementById('scanInput');
const scanCount=document.getElementById('scanCount');
const list=document.getElementById('list');
const card=document.getElementById('customerCard');
const cameraArea=document.getElementById('cameraArea');
const btnCamera=document.getElementById('btnCamera');
const btnStop=document.getElementById('btnStop');

let scanList=JSON.parse(localStorage.getItem('scanList')||'[]');
let codeReader=null;

// í…ŒìŠ¤íŠ¸ìš© ê³ ê° ë°ì´í„°
const customers={
  "1001":{name:"ì´í˜„ìš°",address:"ì„œìš¸ ì†¡íŒŒêµ¬ ì˜¬ë¦¼í”½ë¡œ 300 (101ë™ 202í˜¸)"},
  "1002":{name:"ë°•ì§€ë¯¼",address:"ê²½ê¸° ì‹œí¥ì‹œ ìˆ˜í’€ì•ˆê¸¸ 19-30 (101ë™ 1505í˜¸)"},
  "1003":{name:"ê¹€ìˆ˜í˜„",address:"ê²½ê¸° ì‹œí¥ì‹œ ìˆ˜í’€ì•ˆê¸¸ 19-30 (102ë™ 403í˜¸)"},
  "1004":{name:"ì •ìœ ì§„",address:"ê²½ê¸° ì‹œí¥ì‹œ ìˆ˜í’€ì•ˆê¸¸ 19-30 (105ë™ 303í˜¸)"}
};

// ë¦¬ìŠ¤íŠ¸ í‘œì‹œ
function renderList(){
  list.innerHTML=scanList.map((c,i)=>
    `<div class='item' onclick="showCard('${c}')">#${i+1} ìš´ì†¡ì¥: <b>${c}</b></div>`
  ).join('');
  scanCount.textContent=scanList.length;
  localStorage.setItem('scanList',JSON.stringify(scanList));
  localStorage.setItem('scanned',String(scanList.length));
}

function addScan(code){
  if(!code) return;
  if(scanList.length>=1000){alert("1000ê±´ê¹Œì§€ë§Œ ë“±ë¡ ê°€ëŠ¥í•©ë‹ˆë‹¤.");return;}
  if(!scanList.includes(code)) scanList.unshift(code);
  renderList();
  showCard(code);
  scanInput.value='';
}

function clearList(){
  scanList=[];
  renderList();
  card.textContent="ìŠ¤ìº” ì‹œ ê³ ê°ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤.";
}

function showCard(code){
  const c=customers[code];
  if(!c){ card.innerHTML=`<div class='item'><b>${code}</b> - ë“±ë¡ë˜ì§€ ì•Šì€ ìš´ì†¡ì¥ì…ë‹ˆë‹¤.</div>`; return;}
  card.innerHTML=`<div class='item'><b>ìš´ì†¡ì¥:</b> ${code}<br><b>ê³ ê°:</b> ${c.name}<br><b>ì£¼ì†Œ:</b> ${c.address}</div>`;
}

// ì…ë ¥ì°½ í´ë¦­ ì‹œ ìˆ«ì í‚¤íŒ¨ë“œ í™œì„±í™”
scanInput.addEventListener("focus",()=>scanInput.inputMode="numeric");

// ì¶”ê°€/ì´ˆê¸°í™” ë²„íŠ¼
document.getElementById("btnAdd").onclick=()=>addScan(scanInput.value.trim());
document.getElementById("btnClear").onclick=clearList;

// ì¹´ë©”ë¼ ìŠ¤ìº”
btnCamera.onclick=()=>cameraArea.style.display==='none'?startCam():stopCam();
btnStop.onclick=stopCam;

function startCam(){
  cameraArea.style.display="block";
  codeReader=new ZXing.BrowserMultiFormatReader();
  codeReader.decodeFromVideoDevice(null,"preview",(res,err)=>{
    if(res){ addScan(res.text); stopCam(); }
  });
}
function stopCam(){
  if(codeReader){ codeReader.reset(); codeReader=null; }
  cameraArea.style.display="none";
}

// ê²½ë¡œ ìµœì í™”
document.getElementById("btnOptimize").onclick=()=>{
  if(scanList.length===0){alert("ìŠ¤ìº”ëœ ìš´ì†¡ì¥ì´ ì—†ìŠµë‹ˆë‹¤.");return;}
  alert(`ğŸ§­ ${scanList.length}ê±´ ê²½ë¡œ ìµœì í™” ì™„ë£Œ (ìˆœë²ˆ 1~${scanList.length})`);
  localStorage.setItem("optimizedRoute","1");
};

// ì¶œë°œ ì „ì†¡
document.getElementById("btnStart").onclick=()=>{
  if(scanList.length===0){alert("ìŠ¤ìº”ëœ ìš´ì†¡ì¥ì´ ì—†ìŠµë‹ˆë‹¤.");return;}
  alert("ğŸš€ ì¶œë°œ ì „ì†¡ ì™„ë£Œ\nì§€ë„ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.");
  localStorage.setItem("departStarted","1");
  location.href="map.html";
};

// ì´ˆê¸° í‘œì‹œ
renderList();
</script>
</body>
</html>
