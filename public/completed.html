<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ë°°ì†¡ì™„ë£Œ ë‚´ì—­ - The Listen</title>
<link rel="stylesheet" href="../assets/styles/base.css" />
<style>
  header { background: #007bff; color: #fff; text-align: center; padding: 12px; font-weight: 900; }
  .wrap { max-width: 720px; margin: auto; padding: 14px; }
  .card { background: #fff; border-radius: 14px; padding: 14px; margin-bottom: 12px;
          box-shadow: 0 4px 14px rgba(0,0,0,0.08); cursor: pointer; }
  .title { font-weight: 800; font-size: 16px; }
  .muted { color: #6b7280; font-size: 0.9rem; }
  .badge { display: inline-flex; align-items: center; justify-content: center;
           background: #007bff; color: #fff; font-weight: 900;
           border-radius: 999px; width: 28px; height: 28px; margin-right: 6px; }
  .none { text-align: center; color: #6b7280; padding: 20px 0; }
</style>
</head>
<body>
<header>ğŸ“¦ ë°°ì†¡ì™„ë£Œ ë‚´ì—­ (The Listen)</header>
<div class="wrap" id="root">ë¡œë”© ì¤‘...</div>

<script>
const root = document.getElementById('root');
const completed = JSON.parse(localStorage.getItem('completed') || '[]');

// ë‚ ì§œë³„ ê·¸ë£¹í™”
const byDate = {};
completed.forEach(c => {
  const date = (c.date || '').slice(0,10);
  if (!byDate[date]) byDate[date] = [];
  byDate[date].push(c);
});

if (!Object.keys(byDate).length) {
  root.innerHTML = '<div class="none">ì•„ì§ ì™„ë£Œëœ ë°°ì†¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
} else {
  const sortedDates = Object.keys(byDate).sort((a,b)=>b.localeCompare(a));
  root.innerHTML = sortedDates.map(d => {
    const list = byDate[d].map((x,i)=>`
      <div class="card" data-id="${x.id}">
        <div class="row" style="align-items:center;justify-content:space-between;">
          <div>
            <div class="title">${x.address || 'ì£¼ì†Œ ë¯¸ìƒ'}</div>
            <div class="muted">${(x.waybills||[]).length ? 'ìš´ì†¡ì¥ '+x.waybills.join(', ') : 'ë‹¨ì¼ ìš´ì†¡ì¥'}</div>
          </div>
          <div class="badge">${i+1}</div>
        </div>
      </div>`).join('');
    return `<h3>${d}</h3>${list}`;
  }).join('');
}

// ì¹´ë“œ í´ë¦­ ì‹œ ìƒì„¸ë³´ê¸° ì´ë™
root.addEventListener('click', e => {
  const card = e.target.closest('.card');
  if (!card) return;
  const id = card.getAttribute('data-id');
  localStorage.setItem('detail_target', id);
  location.href = 'receipt.html';
});
</script>
</body>
</html>
